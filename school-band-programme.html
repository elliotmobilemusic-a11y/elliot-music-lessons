<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>School Band Programme – Elliot’s Mobile Music</title>
  <meta
    name="description"
    content="Beginner-friendly in-school band sessions for primary pupils. Small groups (3–4), 30 minutes weekly, all-electric instruments provided, and an end-of-block showcase."
  />
  <meta name="color-scheme" content="dark" />

  <!-- Favicon -->
  <link rel="icon" href="./favicon.png" type="image/png" />

  <!-- PWA -->
  <link rel="manifest" href="./manifest.json" />
  <meta name="theme-color" content="#1a1a2e" />

  <!-- iOS PWA Support -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="apple-touch-icon" href="./icons/icon-192.png" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            "brand-dark-bg": "#1a1a2e",
            "brand-accent-light": "#00d084",
            "brand-accent-dark": "#00a36e",
            "brand-text-light": "#e0e0e0",
            "brand-text-mid": "#a0e0e0",
            "brand-highlight": "#ffb703",
            "card-bg": "#252538",
          },
          fontFamily: {
            sans: ["Inter", "sans-serif"],
            heading: ["Montserrat", "sans-serif"],
          },
        },
      },
    };
  </script>

  <!-- Service Worker (PWA offline + app install) -->
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("./service-worker.js");
      });
    }
  </script>

  <style>
    @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Montserrat:wght@700;800;900&display=swap");

    html {
      scroll-behavior: smooth;
      scroll-padding-top: 5.25rem;
    }

    body {
      font-family: "Inter", sans-serif;
      background-color: #1a1a2e;
      background-image: radial-gradient(circle at 100% 100%, #252538 0%, #1a1a2e 70%);
      overflow-x: hidden;
    }

    .main-hero-shadow {
      text-shadow: 0 0 16px rgba(0, 208, 132, 0.4);
    }

    .card-glow {
      box-shadow: 0 10px 30px rgba(0, 208, 132, 0.12), 0 3px 10px rgba(0, 0, 0, 0.6);
    }

    /* Sticky CTA (mobile-safe) */
    #sticky-cta {
      position: fixed;
      bottom: calc(1.25rem + env(safe-area-inset-bottom));
      left: 1rem;
      right: 1rem;
      max-width: 24rem;
      margin-left: auto;
      margin-right: auto;
      z-index: 100;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.25s ease, transform 0.25s ease;
      pointer-events: none;
    }
    #sticky-cta.show {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }
    @media (min-width: 640px) {
      #sticky-cta {
        left: auto;
        right: 1.5rem;
        max-width: none;
        margin: 0;
      }
    }

    /* Typing indicator */
    @keyframes dot-pulse {
      0%,
      100% {
        opacity: 0.2;
        transform: scale(1);
      }
      50% {
        opacity: 1;
        transform: scale(1.4);
      }
    }
    .dot-1 {
      animation: dot-pulse 1.5s infinite 0s;
    }
    .dot-2 {
      animation: dot-pulse 1.5s infinite 0.2s;
    }
    .dot-3 {
      animation: dot-pulse 1.5s infinite 0.4s;
    }

    /* Subtle scroll reveal animations */
    .reveal {
      opacity: 0;
      transform: translateY(24px);
      transition: opacity 0.8s ease-out, transform 0.8s ease-out;
    }
    .reveal.delayed-1 {
      transition-delay: 0.12s;
    }
    .reveal.delayed-2 {
      transition-delay: 0.2s;
    }
    .reveal.visible {
      opacity: 1;
      transform: translateY(0);
    }

    /* Hover lift utility */
    .hover-lift {
      transition: transform 0.25s ease, box-shadow 0.25s ease, border-color 0.2s ease, background-color 0.2s ease;
    }
    .hover-lift:hover {
      transform: translateY(-4px);
    }

    /* Focus visibility */
    :focus-visible {
      outline: 2px solid rgba(0, 208, 132, 0.75);
      outline-offset: 2px;
    }

    @media (prefers-reduced-motion: reduce) {
      html {
        scroll-behavior: auto;
      }
      .reveal {
        opacity: 1 !important;
        transform: none !important;
        transition: none !important;
      }
      .hover-lift {
        transition: none !important;
      }
      #sticky-cta {
        transition: none !important;
      }
    }
  </style>

  <!-- Lucide Icons -->
  <script type="module">
    import {
      createIcons,
      Zap,
      BookOpen,
      Clock,
      Mail,
      Phone,
      MapPin,
      MessageSquare,
      Star,
      Music2,
      Users,
      Send,
      Shield,
      Volume2,
      CalendarDays,
      CheckCircle2,
      ChevronDown,
    } from "https://cdn.jsdelivr.net/npm/lucide@latest/dist/esm/lucide.js";

    createIcons({
      icons: {
        Zap,
        BookOpen,
        Clock,
        Mail,
        Phone,
        MapPin,
        MessageSquare,
        Star,
        Music2,
        Users,
        Send,
        Shield,
        Volume2,
        CalendarDays,
        CheckCircle2,
        ChevronDown,
      },
    });
  </script>
</head>

<body class="min-h-screen flex flex-col text-brand-text-light">
  <!-- Skip to content -->
  <a
    href="#main-content"
    class="sr-only focus:not-sr-only focus:fixed focus:top-3 focus:left-3 focus:z-[999] focus:px-4 focus:py-2 focus:rounded-lg focus:bg-brand-highlight focus:text-brand-dark-bg focus:font-semibold"
  >
    Skip to content
  </a>

  <!-- NAVIGATION (same structure) -->
  <nav class="bg-brand-dark-bg/90 backdrop-blur border-b border-brand-accent-dark/40 text-white sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <!-- Logo -->
        <a href="index.html" class="flex items-center space-x-2 reveal visible">
          <span class="inline-flex items-center justify-center w-9 h-9 rounded-full bg-brand-accent-light/10 border border-brand-accent-light/50">
            <i data-lucide="music-2" class="w-5 h-5 text-brand-accent-light"></i>
          </span>
          <span class="text-sm sm:text-base font-heading font-extrabold tracking-[0.18em] text-brand-highlight">
            ELLIOT'S MOBILE MUSIC
          </span>
        </a>

        <!-- Desktop nav -->
        <div class="hidden sm:flex sm:space-x-4 text-xs md:text-sm">
          <a href="index.html" class="border-b-2 border-transparent hover:border-brand-accent-light hover:text-white text-brand-text-mid px-3 py-2 font-medium hover-lift">
            HOME
          </a>

          <a href="pricing.html" class="border-b-2 border-transparent hover:border-brand-accent-light hover:text-white text-brand-text-mid px-3 py-2 font-medium hover-lift">
            PRICING &amp; FEES
          </a>

          <a href="availability.html" class="border-b-2 border-transparent hover:border-brand-accent-light hover:text-white text-brand-text-mid px-3 py-2 font-medium hover-lift">
            AVAILABILITY
          </a>

          <a href="school-band-programme.html" class="border-b-2 border-brand-accent-light text-brand-accent-light px-3 py-2 font-medium hover-lift">
            SCHOOL BANDS
          </a>

          <a href="contact.html" class="border-b-2 border-transparent hover:border-brand-accent-light hover:text-white text-brand-text-mid px-3 py-2 font-medium hover-lift">
            CONTACT
          </a>

          <!-- LOGIN BUTTON (desktop) -->
          <a
            href="login.html"
            class="ml-3 px-4 py-2 rounded-lg font-bold text-brand-dark-bg bg-brand-accent-light hover:bg-brand-accent-dark transition duration-200 shadow-md shadow-brand-accent-light/40 hover-lift"
          >
            LOGIN
          </a>
        </div>

        <!-- Mobile button -->
        <div class="sm:hidden">
          <button
            id="mobile-menu-button"
            class="inline-flex items-center justify-center p-2 rounded-md text-gray-300 hover:text-white hover:bg-brand-accent-dark focus:outline-none focus:ring-2 focus:ring-white"
            aria-controls="mobile-menu"
            aria-expanded="false"
            type="button"
          >
            <span class="sr-only">Open main menu</span>
            <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Mobile menu -->
    <div class="sm:hidden hidden" id="mobile-menu">
      <div class="pt-2 pb-3 space-y-1 px-3 text-sm">
        <a href="index.html" class="block rounded-md text-brand-text-mid hover:bg-brand-accent-dark px-3 py-2 font-medium">HOME</a>
        <a href="pricing.html" class="block rounded-md text-brand-text-mid hover:bg-brand-accent-dark px-3 py-2 font-medium">PRICING &amp; FEES</a>
        <a href="availability.html" class="block rounded-md text-brand-text-mid hover:bg-brand-accent-dark px-3 py-2 font-medium">AVAILABILITY</a>
        <a href="school-band-programme.html" class="block rounded-md bg-brand-accent-dark text-white px-3 py-2 font-medium">SCHOOL BANDS</a>
        <a href="contact.html" class="block rounded-md text-brand-text-mid hover:bg-brand-accent-dark px-3 py-2 font-medium">CONTACT</a>

        <a href="login.html" class="block rounded-md mt-1 bg-brand-accent-light text-brand-dark-bg font-bold px-3 py-2 text-center">
          LOGIN
        </a>
      </div>
    </div>
  </nav>

  <main id="main-content" class="flex-grow pb-32">
    <!-- HERO -->
    <section id="hero-section" class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pt-24 sm:pt-32 pb-16 sm:pb-20">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-10 lg:gap-12 items-start">
        <!-- Text side -->
        <div class="reveal">
          <p class="text-xs font-semibold tracking-[0.28em] text-brand-highlight mb-4 uppercase">
            IN-SCHOOL • BEGINNER-FRIENDLY • ALL-ELECTRIC
          </p>

          <h1 class="font-heading text-4xl sm:text-5xl lg:text-6xl font-extrabold main-hero-shadow leading-tight mb-5">
            School Band Programme<br />
            <span class="text-brand-accent-light">small groups • big confidence</span>
          </h1>

          <p class="text-base sm:text-lg text-brand-text-mid max-w-xl mb-7 leading-relaxed">
            Weekly <strong class="text-brand-text-light">30-minute</strong> band sessions for primary pupils in small groups
            (<strong class="text-brand-text-light">3–4</strong> per band), using
            <strong class="text-brand-text-light">all-electric instruments provided</strong> — finishing with a short, informal showcase.
          </p>

          <div class="flex flex-col sm:flex-row gap-4 mb-6">
            <a
              href="contact.html"
              class="inline-flex items-center justify-center px-5 py-3 rounded-lg bg-brand-accent-light text-brand-dark-bg text-sm font-semibold shadow-lg shadow-brand-accent-light/30 hover:bg-brand-accent-dark transform hover:scale-[1.02] transition"
            >
              <i data-lucide="mail" class="w-4 h-4 mr-2"></i>
              Enquire about a Pilot
            </a>

            <a
              href="#pricing"
              class="inline-flex items-center justify-center px-5 py-3 rounded-lg border border-brand-highlight text-brand-highlight text-sm font-semibold hover:bg-brand-highlight/10 transform hover:scale-[1.02] transition"
            >
              View Pricing &amp; Policy
            </a>
          </div>

          <div class="flex flex-wrap items-center gap-4 text-xs sm:text-sm text-brand-text-mid">
            <span class="flex items-center">
              <i data-lucide="phone" class="w-4 h-4 mr-1 text-brand-highlight"></i>
              <a href="tel:07368975144" class="hover:text-white">07368 975144</a>
            </span>

            <span class="flex items-center">
              <i data-lucide="map-pin" class="w-4 h-4 mr-1 text-brand-accent-light"></i>
              Pudsey, Farsley, Calverley, Bramley &amp; West Leeds
            </span>
          </div>

          <div class="mt-6 flex flex-wrap gap-3">
            <div class="flex items-center text-xs sm:text-sm text-brand-text-mid">
              <span class="w-2 h-2 rounded-full bg-brand-accent-light mr-2"></span>
              Minimum <strong class="text-brand-text-light ml-1">3</strong> pupils to run
            </div>
            <div class="flex items-center text-xs sm:text-sm text-brand-text-mid">
              <span class="w-2 h-2 rounded-full bg-brand-highlight mr-2"></span>
              Up to <strong class="text-brand-text-light ml-1">4</strong> per band
            </div>
          </div>
        </div>

        <!-- Overview card -->
        <div class="bg-card-bg/80 rounded-2xl border border-brand-accent-dark/60 card-glow p-7 flex flex-col gap-5 reveal delayed-1">
          <div>
            <p class="text-xs font-semibold tracking-[0.22em] uppercase text-brand-highlight mb-1">AT A GLANCE</p>
            <h2 class="font-heading text-2xl font-bold text-brand-accent-light mb-2">Easy for schools. Brilliant for pupils.</h2>
            <p class="text-sm text-brand-text-mid leading-relaxed">
              Designed to fit school routines, keep volume controlled, and help beginners feel confident fast.
            </p>
          </div>

          <div class="grid grid-cols-2 gap-3 text-xs sm:text-sm pt-3 border-t border-brand-accent-dark/40">
            <div class="flex items-center">
              <i data-lucide="users" class="w-4 h-4 mr-2 text-brand-accent-light"></i>
              3–4 per band
            </div>
            <div class="flex items-center">
              <i data-lucide="clock" class="w-4 h-4 mr-2 text-brand-highlight"></i>
              30 mins weekly
            </div>
            <div class="flex items-center">
              <i data-lucide="music-2" class="w-4 h-4 mr-2 text-brand-accent-light"></i>
              Electric instruments
            </div>
            <div class="flex items-center">
              <i data-lucide="star" class="w-4 h-4 mr-2 text-brand-highlight"></i>
              Showcase included
            </div>
          </div>

          <div class="bg-brand-dark-bg/70 border border-brand-accent-dark/40 rounded-xl p-4 text-xs sm:text-sm text-brand-text-mid leading-relaxed">
            <p class="font-semibold text-brand-text-light mb-1">Who it’s for</p>
            Schools wanting a reliable, low-admin enrichment option — and parents who want confidence, teamwork, and musical progress for their child.
          </div>
        </div>
      </div>
    </section>

    <!-- PROGRAMME AT A GLANCE -->
    <section id="at-a-glance" class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pb-16">
      <div class="reveal">
        <h2 class="font-heading text-2xl sm:text-3xl font-bold text-brand-accent-light mb-2">Programme at a Glance</h2>
        <p class="text-sm sm:text-base text-brand-text-mid max-w-3xl leading-relaxed mb-8">
          A simple structure that schools can timetable and parents can understand instantly.
        </p>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-7">
          <div class="bg-card-bg rounded-xl p-6 border-t-4 border-brand-accent-light card-glow hover-lift reveal">
            <i data-lucide="users" class="w-6 h-6 text-brand-accent-light mb-3"></i>
            <h3 class="font-semibold mb-2 text-brand-text-light">Group size</h3>
            <p class="text-sm text-brand-text-mid leading-relaxed">
              <strong class="text-brand-text-light">3–4 pupils</strong> per band. Minimum <strong class="text-brand-text-light">3</strong> to run.
            </p>
          </div>

          <div class="bg-card-bg rounded-xl p-6 border-t-4 border-brand-highlight card-glow hover-lift reveal delayed-1">
            <i data-lucide="clock" class="w-6 h-6 text-brand-highlight mb-3"></i>
            <h3 class="font-semibold mb-2 text-brand-text-light">Session length</h3>
            <p class="text-sm text-brand-text-mid leading-relaxed">
              <strong class="text-brand-text-light">30 minutes</strong>, once per week, fixed day/time.
            </p>
          </div>

          <div class="bg-card-bg rounded-xl p-6 border-t-4 border-brand-accent-light card-glow hover-lift reveal delayed-2">
            <i data-lucide="music-2" class="w-6 h-6 text-brand-accent-light mb-3"></i>
            <h3 class="font-semibold mb-2 text-brand-text-light">Instruments</h3>
            <p class="text-sm text-brand-text-mid leading-relaxed">
              Electric guitar, bass, keyboard, electronic drums — provided and set up by Elliot.
            </p>
          </div>

          <div class="bg-card-bg rounded-xl p-6 border-t-4 border-brand-accent-light card-glow hover-lift reveal">
            <i data-lucide="calendar-days" class="w-6 h-6 text-brand-accent-light mb-3"></i>
            <h3 class="font-semibold mb-2 text-brand-text-light">6-week block</h3>
            <p class="text-sm text-brand-text-mid leading-relaxed">
              A clear Week 0–6 plan (aligned to half-term where possible).
            </p>
          </div>

          <div class="bg-card-bg rounded-xl p-6 border-t-4 border-brand-highlight card-glow hover-lift reveal delayed-1">
            <i data-lucide="star" class="w-6 h-6 text-brand-highlight mb-3"></i>
            <h3 class="font-semibold mb-2 text-brand-text-light">Showcase</h3>
            <p class="text-sm text-brand-text-mid leading-relaxed">
              Short, informal end-of-block performance during Week 6 (typically 10–20 mins).
            </p>
          </div>

          <div class="bg-card-bg rounded-xl p-6 border-t-4 border-brand-highlight card-glow hover-lift reveal delayed-2">
            <i data-lucide="zap" class="w-6 h-6 text-brand-highlight mb-3"></i>
            <h3 class="font-semibold mb-2 text-brand-text-light">Pricing</h3>
            <p class="text-sm text-brand-text-mid leading-relaxed">
              <strong class="text-brand-text-light">£15</strong> per child per session / <strong class="text-brand-text-light">£90</strong> per child (6 weeks).
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- HOW A 6-WEEK BLOCK RUNS -->
    <section id="timeline" class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pb-16">
      <div class="bg-card-bg rounded-2xl border border-brand-accent-dark/60 card-glow p-7 reveal">
        <h2 class="font-heading text-2xl sm:text-3xl font-bold text-brand-accent-light mb-2">How a 6-week block runs (Week 0–6)</h2>
        <p class="text-sm sm:text-base text-brand-text-mid max-w-3xl leading-relaxed mb-8">
          Clear, predictable progress — and a structure that schools can timetable with confidence.
        </p>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <!-- Timeline -->
          <ol class="space-y-4">
            <li class="flex gap-4">
              <div class="flex flex-col items-center">
                <span class="w-9 h-9 rounded-full bg-brand-highlight/15 border border-brand-highlight/50 flex items-center justify-center">
                  <span class="font-heading font-extrabold text-brand-highlight text-sm">W0</span>
                </span>
                <span class="w-[2px] flex-1 bg-brand-accent-dark/30 mt-2"></span>
              </div>
              <div>
                <p class="font-semibold text-brand-text-light">Week 0 — Sign-ups &amp; band setup</p>
                <p class="text-sm text-brand-text-mid mt-1 leading-relaxed">
                  Preferences collected, groups formed, schedule confirmed, payment collected before Week 1.
                </p>
              </div>
            </li>

            <li class="flex gap-4">
              <div class="flex flex-col items-center">
                <span class="w-9 h-9 rounded-full bg-brand-accent-light/15 border border-brand-accent-light/50 flex items-center justify-center">
                  <span class="font-heading font-extrabold text-brand-accent-light text-sm">W1</span>
                </span>
                <span class="w-[2px] flex-1 bg-brand-accent-dark/30 mt-2"></span>
              </div>
              <div>
                <p class="font-semibold text-brand-text-light">Week 1 — Foundations &amp; routines</p>
                <p class="text-sm text-brand-text-mid mt-1 leading-relaxed">
                  Instrument roles set, basics taught, band routine begins. No late joiners after this week.
                </p>
              </div>
            </li>

            <li class="flex gap-4">
              <div class="flex flex-col items-center">
                <span class="w-9 h-9 rounded-full bg-brand-highlight/15 border border-brand-highlight/50 flex items-center justify-center">
                  <span class="font-heading font-extrabold text-brand-highlight text-sm">W2</span>
                </span>
                <span class="w-[2px] flex-1 bg-brand-accent-dark/30 mt-2"></span>
              </div>
              <div>
                <p class="font-semibold text-brand-text-light">Week 2 — Lock in the parts</p>
                <p class="text-sm text-brand-text-mid mt-1 leading-relaxed">
                  Simple parts become consistent; focus on timing, starting together, and stopping together.
                </p>
              </div>
            </li>

            <li class="flex gap-4">
              <div class="flex flex-col items-center">
                <span class="w-9 h-9 rounded-full bg-brand-accent-light/15 border border-brand-accent-light/50 flex items-center justify-center">
                  <span class="font-heading font-extrabold text-brand-accent-light text-sm">W3–4</span>
                </span>
                <span class="w-[2px] flex-1 bg-brand-accent-dark/30 mt-2"></span>
              </div>
              <div>
                <p class="font-semibold text-brand-text-light">Weeks 3–4 — Build the song</p>
                <p class="text-sm text-brand-text-mid mt-1 leading-relaxed">
                  Sections are built and joined; transitions introduced; confidence increases quickly.
                </p>
              </div>
            </li>

            <li class="flex gap-4">
              <div class="flex flex-col items-center">
                <span class="w-9 h-9 rounded-full bg-brand-highlight/15 border border-brand-highlight/50 flex items-center justify-center">
                  <span class="font-heading font-extrabold text-brand-highlight text-sm">W5</span>
                </span>
                <span class="w-[2px] flex-1 bg-brand-accent-dark/30 mt-2"></span>
              </div>
              <div>
                <p class="font-semibold text-brand-text-light">Week 5 — Performance prep</p>
                <p class="text-sm text-brand-text-mid mt-1 leading-relaxed">
                  Full run-throughs, tidy transitions, clear performance plan for Week 6.
                </p>
              </div>
            </li>

            <li class="flex gap-4">
              <div class="flex flex-col items-center">
                <span class="w-9 h-9 rounded-full bg-brand-accent-light/15 border border-brand-accent-light/50 flex items-center justify-center">
                  <span class="font-heading font-extrabold text-brand-accent-light text-sm">W6</span>
                </span>
              </div>
              <div>
                <p class="font-semibold text-brand-text-light">Week 6 — Final rehearsal + showcase</p>
                <p class="text-sm text-brand-text-mid mt-1 leading-relaxed">
                  Final session includes rehearsal and a short informal showcase (typically 10–20 mins).
                </p>
              </div>
            </li>
          </ol>

          <!-- Session format -->
          <div class="bg-brand-dark-bg/70 border border-brand-accent-dark/40 rounded-2xl p-6">
            <h3 class="font-heading text-xl font-bold text-brand-highlight mb-3">What happens in a 30-minute session</h3>

            <div class="space-y-3 text-sm text-brand-text-mid leading-relaxed">
              <div class="bg-card-bg/40 border border-brand-accent-dark/40 rounded-xl p-4">
                <p class="font-semibold text-brand-text-light">0–5 mins</p>
                Warm-up, rhythm focus, quick setup and role check.
              </div>

              <div class="bg-card-bg/40 border border-brand-accent-dark/40 rounded-xl p-4">
                <p class="font-semibold text-brand-text-light">5–15 mins</p>
                One clear skill focus (age-appropriate and beginner-friendly).
              </div>

              <div class="bg-card-bg/40 border border-brand-accent-dark/40 rounded-xl p-4">
                <p class="font-semibold text-brand-text-light">15–25 mins</p>
                Band rehearsal — build the song in small, repeatable sections.
              </div>

              <div class="bg-card-bg/40 border border-brand-accent-dark/40 rounded-xl p-4">
                <p class="font-semibold text-brand-text-light">25–30 mins</p>
                Run-through, quick feedback, pack down.
              </div>

              <div class="mt-2 text-xs sm:text-sm text-brand-text-mid">
                Sessions are fixed weekly and aren’t rearranged for individual absences.
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- WHAT ELLIOT PROVIDES VS SCHOOL PROVIDES -->
    <section id="responsibilities" class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pb-16">
      <div class="bg-card-bg rounded-2xl border border-brand-accent-dark/60 card-glow p-7 reveal">
        <h2 class="font-heading text-2xl sm:text-3xl font-bold text-brand-accent-light mb-2">
          What Elliot provides vs what the school provides
        </h2>
        <p class="text-sm sm:text-base text-brand-text-mid max-w-3xl leading-relaxed mb-8">
          Clear responsibilities keep the programme smooth, safe, and consistent with school routines.
        </p>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-7">
          <div class="bg-brand-dark-bg/70 border border-brand-accent-dark/40 rounded-2xl p-6">
            <p class="text-xs font-semibold tracking-[0.22em] uppercase text-brand-highlight mb-3">
              Provided by Elliot’s Mobile Music
            </p>
            <ul class="space-y-3 text-sm text-brand-text-mid leading-relaxed">
              <li class="flex gap-2">
                <i data-lucide="check-circle-2" class="w-4 h-4 mt-0.5 text-brand-accent-light"></i>
                Tutor delivery + structured beginner plan
              </li>
              <li class="flex gap-2">
                <i data-lucide="check-circle-2" class="w-4 h-4 mt-0.5 text-brand-accent-light"></i>
                Electric instruments + sound setup (mixer/speaker as needed)
              </li>
              <li class="flex gap-2">
                <i data-lucide="check-circle-2" class="w-4 h-4 mt-0.5 text-brand-accent-light"></i>
                Parent comms, sign-up info, and payment handling (as agreed)
              </li>
              <li class="flex gap-2">
                <i data-lucide="check-circle-2" class="w-4 h-4 mt-0.5 text-brand-accent-light"></i>
                Attendance tracking and simple progress notes
              </li>
            </ul>
          </div>

          <div class="bg-brand-dark-bg/70 border border-brand-accent-dark/40 rounded-2xl p-6">
            <p class="text-xs font-semibold tracking-[0.22em] uppercase text-brand-highlight mb-3">
              Provided by the school
            </p>
            <ul class="space-y-3 text-sm text-brand-text-mid leading-relaxed">
              <li class="flex gap-2">
                <i data-lucide="check-circle-2" class="w-4 h-4 mt-0.5 text-brand-highlight"></i>
                A suitable room/space for a small group
              </li>
              <li class="flex gap-2">
                <i data-lucide="check-circle-2" class="w-4 h-4 mt-0.5 text-brand-highlight"></i>
                Timetable support (fixed weekly slot)
              </li>
              <li class="flex gap-2">
                <i data-lucide="check-circle-2" class="w-4 h-4 mt-0.5 text-brand-highlight"></i>
                Supporting pupils to/from sessions (school routine)
              </li>
              <li class="flex gap-2">
                <i data-lucide="check-circle-2" class="w-4 h-4 mt-0.5 text-brand-highlight"></i>
                Safeguarding supervision arrangements (school policy)
              </li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- SAFEGUARDING & SAFETY -->
    <section id="safeguarding" class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pb-16">
      <div class="bg-card-bg rounded-2xl border border-brand-accent-dark/60 card-glow p-7 reveal">
        <h2 class="font-heading text-2xl sm:text-3xl font-bold text-brand-highlight mb-2 flex items-center">
          <i data-lucide="shield" class="w-6 h-6 mr-2 text-brand-accent-light"></i>
          Safeguarding &amp; Safety (summary)
        </h2>
        <p class="text-sm sm:text-base text-brand-text-mid max-w-3xl leading-relaxed mb-8">
          A tidy, controlled setup with safeguarding aligned to school expectations.
        </p>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-7">
          <div class="bg-brand-dark-bg/70 border border-brand-accent-dark/40 rounded-2xl p-6">
            <h3 class="font-heading text-xl font-bold text-brand-accent-light mb-3 flex items-center">
              <i data-lucide="volume-2" class="w-5 h-5 mr-2 text-brand-highlight"></i>
              Safety in the room
            </h3>
            <ul class="space-y-3 text-sm text-brand-text-mid leading-relaxed">
              <li class="flex gap-2">
                <i data-lucide="check-circle-2" class="w-4 h-4 mt-0.5 text-brand-accent-light"></i>
                Cables are routed safely; any cable crossing a walkway is <strong class="text-brand-text-light">taped down</strong>.
              </li>
              <li class="flex gap-2">
                <i data-lucide="check-circle-2" class="w-4 h-4 mt-0.5 text-brand-accent-light"></i>
                Volume is controlled through a mixer to keep levels comfortable and appropriate.
              </li>
              <li class="flex gap-2">
                <i data-lucide="check-circle-2" class="w-4 h-4 mt-0.5 text-brand-accent-light"></i>
                Walkways kept clear with a tidy, quick pack-down routine.
              </li>
              <li class="flex gap-2">
                <i data-lucide="check-circle-2" class="w-4 h-4 mt-0.5 text-brand-accent-light"></i>
                All-electric instruments for predictable sound levels and clean setup.
              </li>
            </ul>
          </div>

          <div class="bg-brand-dark-bg/70 border border-brand-accent-dark/40 rounded-2xl p-6">
            <h3 class="font-heading text-xl font-bold text-brand-accent-light mb-3 flex items-center">
              <i data-lucide="book-open" class="w-5 h-5 mr-2 text-brand-highlight"></i>
              Safeguarding approach
            </h3>
            <ul class="space-y-3 text-sm text-brand-text-mid leading-relaxed">
              <li class="flex gap-2">
                <i data-lucide="check-circle-2" class="w-4 h-4 mt-0.5 text-brand-highlight"></i>
                Sessions follow the school’s safeguarding expectations and agreed supervision arrangements.
              </li>
              <li class="flex gap-2">
                <i data-lucide="check-circle-2" class="w-4 h-4 mt-0.5 text-brand-highlight"></i>
                Any concern is handled via the school DSL process and reported appropriately.
              </li>
              <li class="flex gap-2">
                <i data-lucide="check-circle-2" class="w-4 h-4 mt-0.5 text-brand-highlight"></i>
                Pupils follow school behaviour rules; unsafe behaviour may pause/end a session until a plan is agreed.
              </li>
              <li class="flex gap-2">
                <i data-lucide="check-circle-2" class="w-4 h-4 mt-0.5 text-brand-highlight"></i>
                Photos/videos used only with explicit consent; consent can be withdrawn at any time.
              </li>
            </ul>
          </div>
        </div>

        <div class="mt-7 bg-brand-dark-bg/70 border border-brand-accent-dark/40 rounded-xl p-5 text-xs sm:text-sm text-brand-text-mid leading-relaxed">
          <p class="font-semibold text-brand-text-light mb-1">School-friendly by design</p>
          The programme is structured to be easy to timetable, easy to supervise, and supportive for beginner pupils.
        </div>
      </div>
    </section>

    <!-- PRICING -->
    <section id="pricing" class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pb-16">
      <div class="bg-card-bg rounded-2xl border border-brand-accent-dark/60 card-glow p-7 reveal">
        <h2 class="font-heading text-2xl sm:text-3xl font-bold text-brand-highlight mb-2">Pricing</h2>
        <p class="text-sm sm:text-base text-brand-text-mid max-w-3xl leading-relaxed mb-8">
          Clear, simple pricing that works for parents and is easy for schools to communicate.
        </p>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-7">
          <div class="bg-brand-dark-bg/70 border border-brand-accent-dark/40 rounded-2xl p-6">
            <p class="text-xs font-semibold tracking-[0.22em] uppercase text-brand-highlight mb-3">Core pricing</p>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
              <div class="bg-card-bg/40 border border-brand-accent-dark/40 rounded-xl p-4">
                <p class="text-3xl font-extrabold text-brand-accent-light leading-none">£15</p>
                <p class="text-sm text-brand-text-mid mt-1">per child, per session</p>
              </div>

              <div class="bg-card-bg/40 border border-brand-accent-dark/40 rounded-xl p-4">
                <p class="text-3xl font-extrabold text-brand-highlight leading-none">£90</p>
                <p class="text-sm text-brand-text-mid mt-1">per child, 6-week block</p>
              </div>

              <div class="bg-card-bg/40 border border-brand-accent-dark/40 rounded-xl p-4 sm:col-span-2">
                <p class="font-semibold text-brand-text-light mb-1">Minimum numbers</p>
                <p class="text-sm text-brand-text-mid leading-relaxed">
                  Minimum <strong class="text-brand-text-light">3</strong> pupils to run, up to <strong class="text-brand-text-light">4</strong> per band.
                </p>
              </div>
            </div>

            <p class="text-xs sm:text-sm text-brand-text-mid mt-4 leading-relaxed">
              Payment is collected in advance to confirm places before Week 1.
            </p>
          </div>

          <div class="bg-brand-dark-bg/70 border border-brand-accent-dark/40 rounded-2xl p-6">
            <p class="text-xs font-semibold tracking-[0.22em] uppercase text-brand-highlight mb-3">Policy summary</p>
            <ul class="space-y-3 text-sm text-brand-text-mid leading-relaxed">
              <li class="flex gap-2">
                <i data-lucide="check-circle-2" class="w-4 h-4 mt-0.5 text-brand-accent-light"></i>
                Missed sessions (child absent) aren’t refundable and aren’t rearranged.
              </li>
              <li class="flex gap-2">
                <i data-lucide="check-circle-2" class="w-4 h-4 mt-0.5 text-brand-accent-light"></i>
                If Elliot cancels: a make-up session or credit is offered where reasonably possible.
              </li>
              <li class="flex gap-2">
                <i data-lucide="check-circle-2" class="w-4 h-4 mt-0.5 text-brand-highlight"></i>
                School closures/events: credited or rescheduled where possible.
              </li>
              <li class="flex gap-2">
                <i data-lucide="check-circle-2" class="w-4 h-4 mt-0.5 text-brand-highlight"></i>
                Late joiners aren’t accepted after Week 1; instrument changes after Week 1 aren’t standard.
              </li>
            </ul>

            <div class="mt-5 bg-card-bg/40 border border-brand-accent-dark/40 rounded-xl p-4 text-xs sm:text-sm text-brand-text-mid leading-relaxed">
              <p class="font-semibold text-brand-text-light mb-1">Need a pilot?</p>
              Schools can enquire about a pilot slot and setup plan via the contact page.
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- FAQ -->
    <section id="faq" class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pb-16">
      <div class="bg-card-bg rounded-2xl border border-brand-accent-dark/60 card-glow p-7 reveal">
        <h2 class="font-heading text-2xl sm:text-3xl font-bold text-brand-accent-light mb-2">FAQ</h2>
        <p class="text-sm sm:text-base text-brand-text-mid max-w-3xl leading-relaxed mb-8">
          The most common questions from schools and parents.
        </p>

        <div class="space-y-3">
          <details class="bg-brand-dark-bg/70 border border-brand-accent-dark/40 rounded-xl p-5">
            <summary class="cursor-pointer font-semibold text-brand-text-light flex items-center justify-between gap-3">
              <span>Does my child need experience?</span>
              <i data-lucide="chevron-down" class="w-4 h-4 text-brand-text-mid"></i>
            </summary>
            <p class="mt-3 text-sm text-brand-text-mid leading-relaxed">
              No — it’s designed for <strong class="text-brand-text-light">complete beginners</strong>. Pupils learn simple parts that work together as a band.
            </p>
          </details>

          <details class="bg-brand-dark-bg/70 border border-brand-accent-dark/40 rounded-xl p-5">
            <summary class="cursor-pointer font-semibold text-brand-text-light flex items-center justify-between gap-3">
              <span>Do pupils take instruments home?</span>
              <i data-lucide="chevron-down" class="w-4 h-4 text-brand-text-mid"></i>
            </summary>
            <p class="mt-3 text-sm text-brand-text-mid leading-relaxed">
              Instruments are provided for <strong class="text-brand-text-light">in-school use during sessions</strong>.
            </p>
          </details>

          <details class="bg-brand-dark-bg/70 border border-brand-accent-dark/40 rounded-xl p-5">
            <summary class="cursor-pointer font-semibold text-brand-text-light flex items-center justify-between gap-3">
              <span>How loud is it?</span>
              <i data-lucide="chevron-down" class="w-4 h-4 text-brand-text-mid"></i>
            </summary>
            <p class="mt-3 text-sm text-brand-text-mid leading-relaxed">
              It’s an all-electric setup with levels controlled through a mixer — volume is kept appropriate for the room and can be adjusted.
            </p>
          </details>

          <details class="bg-brand-dark-bg/70 border border-brand-accent-dark/40 rounded-xl p-5">
            <summary class="cursor-pointer font-semibold text-brand-text-light flex items-center justify-between gap-3">
              <span>What if a child misses a session?</span>
              <i data-lucide="chevron-down" class="w-4 h-4 text-brand-text-mid"></i>
            </summary>
            <p class="mt-3 text-sm text-brand-text-mid leading-relaxed">
              Sessions aren’t rearranged for individual absences and aren’t refundable — the band slot is reserved each week.
            </p>
          </details>

          <details class="bg-brand-dark-bg/70 border border-brand-accent-dark/40 rounded-xl p-5">
            <summary class="cursor-pointer font-semibold text-brand-text-light flex items-center justify-between gap-3">
              <span>Can pupils swap instruments mid-block?</span>
              <i data-lucide="chevron-down" class="w-4 h-4 text-brand-text-mid"></i>
            </summary>
            <p class="mt-3 text-sm text-brand-text-mid leading-relaxed">
              Instrument roles are set by Week 1 to keep the band balanced. Changes after Week 1 aren’t standard unless needed for practical/safeguarding reasons.
            </p>
          </details>

          <details class="bg-brand-dark-bg/70 border border-brand-accent-dark/40 rounded-xl p-5">
            <summary class="cursor-pointer font-semibold text-brand-text-light flex items-center justify-between gap-3">
              <span>What does the school need to provide?</span>
              <i data-lucide="chevron-down" class="w-4 h-4 text-brand-text-mid"></i>
            </summary>
            <p class="mt-3 text-sm text-brand-text-mid leading-relaxed">
              A suitable room, timetable support, and pupil movement/supervision arrangements in line with school policy.
            </p>
          </details>

          <details class="bg-brand-dark-bg/70 border border-brand-accent-dark/40 rounded-xl p-5">
            <summary class="cursor-pointer font-semibold text-brand-text-light flex items-center justify-between gap-3">
              <span>What happens if numbers are too low?</span>
              <i data-lucide="chevron-down" class="w-4 h-4 text-brand-text-mid"></i>
            </summary>
            <p class="mt-3 text-sm text-brand-text-mid leading-relaxed">
              Minimum is <strong class="text-brand-text-light">3 pupils</strong>. If a group isn’t viable by the cut-off, an alternative group, deferment, or refund can be offered.
            </p>
          </details>
        </div>
      </div>
    </section>

    <!-- SCHOOL BAND Q&A ASSISTANT (calls POST /api/chat) -->
    <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pb-28">
      <div class="bg-card-bg rounded-2xl border border-brand-accent-dark/60 card-glow p-7 reveal">
        <div class="flex flex-wrap items-center justify-between gap-3 border-b border-brand-accent-dark/40 pb-4 mb-5">
          <div>
            <h2 class="font-heading text-2xl font-bold text-brand-highlight flex items-center">
              <i data-lucide="message-square" class="w-6 h-6 mr-2 text-brand-accent-light"></i>
              School Band Q&amp;A Assistant
            </h2>
            <p class="text-xs sm:text-sm text-brand-text-mid mt-1 max-w-xl leading-relaxed">
              Ask about pricing, timetable, equipment, minimum numbers, safeguarding, or how the 6-week block runs.
            </p>
          </div>

          <a href="contact.html" class="text-xs sm:text-sm font-semibold text-brand-highlight hover:text-brand-accent-light transition">
            Contact Elliot
          </a>
        </div>

        <div
          id="chat-box"
          class="h-[22rem] md:h-80 overflow-y-auto p-4 mb-4 rounded-lg bg-brand-dark-bg border border-brand-accent-dark/50 space-y-3"
          role="log"
          aria-live="polite"
        >
          <div class="flex justify-start initial-message">
            <div class="max-w-[75%] bg-brand-accent-light/20 text-brand-text-light p-3 rounded-xl rounded-tl-none text-sm shadow leading-relaxed">
              Hello! I’m the School Band Programme assistant. Ask me anything about costs, scheduling, equipment, or how the programme runs.
            </div>
          </div>

          <div id="loading-indicator" class="hidden flex justify-start">
            <div class="max-w-[75%] bg-brand-highlight/20 text-brand-highlight p-3 rounded-xl rounded-tl-none text-sm shadow flex items-center space-x-1">
              <span class="text-sm">Typing</span>
              <span class="w-2 h-2 bg-brand-highlight rounded-full dot-1"></span>
              <span class="w-2 h-2 bg-brand-highlight rounded-full dot-2"></span>
              <span class="w-2 h-2 bg-brand-highlight rounded-full dot-3"></span>
            </div>
          </div>
        </div>

        <form id="chat-form" class="flex gap-2">
          <input
            type="text"
            id="chat-input"
            placeholder="E.g. What’s included? How many pupils per band? What if a child is absent?"
            class="flex-grow p-3 rounded-lg bg-brand-dark-bg border border-brand-text-mid/50 focus:outline-none text-brand-text-light text-sm focus:border-brand-accent-light focus:ring-2 focus:ring-brand-accent-light/40"
            autocomplete="off"
          />
          <button
            type="submit"
            id="send-button"
            class="bg-brand-highlight text-brand-dark-bg px-3 rounded-lg font-semibold hover:bg-brand-highlight/80 transition flex items-center justify-center w-11 h-11"
            aria-label="Send message"
          >
            <i data-lucide="send" class="w-5 h-5"></i>
          </button>
        </form>
        <p id="error-message" class="text-xs text-red-400 mt-2 hidden"></p>
      </div>
    </section>
  </main>

  <!-- STICKY CTA -->
  <a
    href="contact.html"
    id="sticky-cta"
    class="inline-flex items-center justify-center px-4 py-2.5 text-sm font-semibold rounded-full text-brand-dark-bg bg-brand-accent-light hover:bg-brand-accent-dark shadow-xl shadow-brand-accent-light/50"
  >
    <i data-lucide="mail" class="w-4 h-4 mr-1"></i> Enquire about a Pilot
  </a>

  <!-- FOOTER -->
  <footer class="bg-gray-900 text-brand-text-mid py-7 mt-2">
    <div class="max-w-6xl mx-auto px-4 text-center text-xs sm:text-sm">
      <p>&copy; 2024 Elliot Wardill Mobile Music Lessons. All rights reserved.</p>
      <p class="mt-1 text-gray-500">
        DBS Checked &amp; Insured. Programme details are confirmed with schools during setup.
      </p>
    </div>
  </footer>

  <!-- JS -->
  <script>
    // Mobile menu toggle (clean + accessible)
    const mobileMenuButton = document.getElementById("mobile-menu-button");
    const mobileMenu = document.getElementById("mobile-menu");

    function setMobileMenu(open) {
      if (!mobileMenuButton || !mobileMenu) return;
      mobileMenu.classList.toggle("hidden", !open);
      mobileMenuButton.setAttribute("aria-expanded", open ? "true" : "false");
    }

    if (mobileMenuButton && mobileMenu) {
      mobileMenuButton.addEventListener("click", () => {
        const isOpen = mobileMenuButton.getAttribute("aria-expanded") === "true";
        setMobileMenu(!isOpen);
      });

      mobileMenu.querySelectorAll("a").forEach((a) => a.addEventListener("click", () => setMobileMenu(false)));

      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") setMobileMenu(false);
      });

      document.addEventListener("click", (e) => {
        if (mobileMenu.classList.contains("hidden")) return;
        const within = mobileMenu.contains(e.target) || mobileMenuButton.contains(e.target);
        if (!within) setMobileMenu(false);
      });
    }

    // Sticky CTA visibility (show after hero)
    const stickyCta = document.getElementById("sticky-cta");
    const heroSection = document.getElementById("hero-section");

    if (stickyCta && heroSection) {
      const observer = new IntersectionObserver(
        ([entry]) => {
          if (entry.isIntersecting) stickyCta.classList.remove("show");
          else stickyCta.classList.add("show");
        },
        { rootMargin: "0px 0px -70% 0px", threshold: 0.1 }
      );
      observer.observe(heroSection);
    }

    // Scroll reveal on sections
    const revealElements = document.querySelectorAll(".reveal");
    const reduceMotion = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;

    if (!reduceMotion && revealElements.length) {
      const revealObserver = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add("visible");
              revealObserver.unobserve(entry.target);
            }
          });
        },
        { threshold: 0.15 }
      );
      revealElements.forEach((el) => revealObserver.observe(el));
    } else {
      revealElements.forEach((el) => el.classList.add("visible"));
    }

    // ===== School Band Q&A Assistant (frontend, calls /api/chat) =====
    const chatForm = document.getElementById("chat-form");
    const chatInput = document.getElementById("chat-input");
    const chatBox = document.getElementById("chat-box");
    const loadingIndicator = document.getElementById("loading-indicator");
    const errorMessage = document.getElementById("error-message");
    const sendButton = document.getElementById("send-button");

    const qaSystemPrompt = `You are a helpful, friendly Q&A assistant for Elliot’s Mobile Music — School Band Programme.
Answer briefly and clearly, using **bold** for key details. Audience: schools and parents.

Programme summary:
- Beginner-friendly in-school band sessions for primary pupils.
- Group size: up to **4 pupils** per band. Minimum **3 pupils** required for a group to run.
- Session length/frequency: **30 minutes**, **once per week**, fixed day/time.
- Standard block: **6 weeks** (Week 0–6) + informal showcase during Week 6.

Instruments (all-electric, provided for in-school sessions):
- Keyboard, electric guitar, electric bass, electronic drums.
- Volume controlled (mixer/levels). Cables routed safely; any cable crossing a walkway is taped down.

Sign-ups:
- Preferences collected in Week 0.
- Late joiners not accepted after Week 1.
- Instrument changes after Week 1 are not standard (unless practical/safeguarding need).

Pricing:
- **£15 per child per session**
- **£90 per child for a 6-week block**
- Minimum **3** to run; up to **4** per band.

Policies (summary):
- Missed sessions (child absent): not refundable; sessions aren’t rearranged for individual absences.
- If Elliot cancels: make-up session or credit where reasonably possible.
- School closures/events: credited or rescheduled where possible.
- Safeguarding follows school expectations; concerns handled via the school’s DSL process.

If asked something not covered, explain what you can confirm and suggest contacting Elliot via contact.html or 07368 975144.`;

    function escapeHTML(str) {
      return (str || "").replace(/[&<>"']/g, (ch) => {
        const map = { "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#039;" };
        return map[ch] || ch;
      });
    }

    function appendMessage(sender, text) {
      const wrap = document.createElement("div");
      wrap.classList.add("flex", sender === "user" ? "justify-end" : "justify-start");

      const bubble = document.createElement("div");
      bubble.classList.add("max-w-[75%]", "p-3", "rounded-xl", "text-sm", "shadow", "break-words", "whitespace-pre-wrap", "leading-relaxed");

      if (sender === "user") {
        bubble.classList.add("bg-brand-highlight", "text-brand-dark-bg", "rounded-tr-none");
      } else {
        bubble.classList.add("bg-brand-accent-light/20", "text-brand-text-light", "rounded-tl-none");
      }

      const p = document.createElement("p");
      const safe = escapeHTML(text || "");
      p.innerHTML = safe.replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>");
      bubble.appendChild(p);

      wrap.appendChild(bubble);
      chatBox.insertBefore(wrap, loadingIndicator);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    async function handleQuery(query) {
      sendButton.disabled = true;
      loadingIndicator.classList.remove("hidden");
      errorMessage.classList.add("hidden");

      appendMessage("user", query);

      try {
        const res = await fetch("/api/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            message: query.trim(),
            systemPrompt: qaSystemPrompt,
          }),
        });

        if (!res.ok) throw new Error("Server error: " + res.status);

        const data = await res.json();
        const text = data.text || "I couldn't find a clear answer there — try asking in a slightly different way.";
        appendMessage("bot", text);
      } catch (err) {
        console.error(err);
        errorMessage.textContent = "Sorry, the assistant is unavailable at the moment. Please try again later.";
        errorMessage.classList.remove("hidden");
      } finally {
        loadingIndicator.classList.add("hidden");
        sendButton.disabled = false;
        chatInput.value = "";
      }
    }

    if (chatForm) {
      chatForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const q = chatInput.value.trim();
        if (!q) return;

        const initialMsg = chatBox.querySelector(".initial-message");
        if (initialMsg) initialMsg.remove();

        handleQuery(q);
      });
    }
  </script>
</body>
</html>
