<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>School Band Programme – Register Interest (Deposit)</title>
  <meta name="color-scheme" content="dark" />

  <link rel="icon" href="./favicon.png" type="image/png" />

  <!-- PWA -->
  <link rel="manifest" href="./manifest.json" />
  <meta name="theme-color" content="#1a1a2e" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="apple-touch-icon" href="./icons/icon-192.png" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            "brand-dark-bg": "#1a1a2e",
            "brand-accent-light": "#00d084",
            "brand-accent-dark": "#00a36e",
            "brand-text-light": "#e0e0e0",
            "brand-text-mid": "#a0e0e0",
            "brand-highlight": "#ffb703",
            "card-bg": "#252538",
          },
          fontFamily: {
            sans: ["Inter", "sans-serif"],
            heading: ["Montserrat", "sans-serif"],
          },
        },
      },
    };
  </script>

  <style>
    @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Montserrat:wght@700;800;900&display=swap");

    html, body { height: 100%; }
    body{
      margin:0;
      font-family:Inter,sans-serif;
      background-color:#1a1a2e;
      background-image:
        radial-gradient(circle at 12% 12%, rgba(0,208,132,.12), transparent 55%),
        radial-gradient(circle at 88% 18%, rgba(255,183,3,.10), transparent 60%),
        radial-gradient(circle at 100% 100%, #252538 0%, #1a1a2e 70%);
    }
    .card-glow{box-shadow:0 12px 34px rgba(0,208,132,.11),0 3px 12px rgba(0,0,0,.65)}
    .hr-glow{height:1px;background:linear-gradient(90deg,transparent,rgba(0,208,132,.55),transparent)}
    .tally-frame{
      border-radius: 18px;
      overflow: hidden;
      border: 1px solid rgba(0,163,110,.55);
      background: rgba(26,26,46,.55);
      box-shadow: 0 14px 40px rgba(0,208,132,.10), 0 3px 12px rgba(0,0,0,.55);
    }
    .tally-iframe{
      width:100%;
      border:0;
      background:transparent;
      min-height: 1800px;
      border-radius: 16px;
    }
    @media (max-width: 640px){
      .tally-iframe{ min-height: 2200px; }
    }
  </style>

  <!-- Service Worker -->
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => navigator.serviceWorker.register("./service-worker.js"));
    }
  </script>

  <!-- Tally -->
  <script async src="https://tally.so/widgets/embed.js"></script>
</head>

<body class="min-h-screen text-brand-text-light">
  <!-- NAV -->
  <nav class="bg-brand-dark-bg/90 backdrop-blur border-b border-brand-accent-dark/40 text-white sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <a href="index.html" class="flex items-center space-x-2">
          <span class="inline-flex items-center justify-center w-9 h-9 rounded-full bg-brand-accent-light/10 border border-brand-accent-light/50">
            <span class="text-brand-accent-light font-black">♪</span>
          </span>
          <span class="text-sm sm:text-base font-heading font-extrabold tracking-[0.18em] text-brand-highlight">
            ELLIOT'S MOBILE MUSIC
          </span>
        </a>

        <div class="hidden md:flex items-center gap-3">
          <a href="school-band-programme.html" class="text-sm font-extrabold text-brand-accent-light hover:text-brand-highlight transition">
            ← Back to programme page
          </a>
          <a href="contact.html" class="px-4 py-2 rounded-lg font-bold text-brand-dark-bg bg-brand-accent-light hover:bg-brand-accent-dark transition shadow-md shadow-brand-accent-light/40">
            CONTACT
          </a>
        </div>

        <div class="md:hidden">
          <a href="school-band-programme.html" class="text-sm font-extrabold text-brand-accent-light">
            ← Back
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- FULL SCREEN LAYOUT -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
      <!-- Details (left on desktop, top on mobile) -->
      <aside class="lg:col-span-4 space-y-6">
        <div class="bg-card-bg/85 rounded-2xl border border-brand-accent-dark/60 card-glow p-6">
          <h1 class="font-heading text-2xl font-extrabold text-brand-highlight">Register Interest (Deposit)</h1>
          <p class="text-sm text-brand-text-mid mt-2 leading-relaxed">
            You’re on the secure registration page for parents/carers.
            Please complete the form and pay the <span class="font-extrabold text-brand-text-light">£10 deposit</span>.
          </p>
          <div class="hr-glow my-5"></div>
          <div class="text-sm text-brand-text-mid leading-relaxed space-y-2">
            <p><span class="text-brand-accent-light font-extrabold">•</span> Deposit comes off the total cost.</p>
            <p><span class="text-brand-accent-light font-extrabold">•</span> If no suitable place/time can be offered, deposit is refunded.</p>
            <p><span class="text-brand-accent-light font-extrabold">•</span> If you cancel after a place/time is offered, deposit may be non-refundable.</p>
          </div>
        </div>

        <div class="bg-brand-dark-bg/55 rounded-2xl border border-brand-accent-dark/50 p-6">
          <h2 class="font-heading text-lg font-extrabold text-brand-text-light">How it works</h2>
          <ol class="mt-3 space-y-2 text-sm text-brand-text-mid leading-relaxed">
            <li><span class="text-brand-highlight font-extrabold">1.</span> Register + deposit.</li>
            <li><span class="text-brand-highlight font-extrabold">2.</span> Bands (3–4) + weekly time confirmed with school.</li>
            <li><span class="text-brand-highlight font-extrabold">3.</span> Remaining balance collected before Week 1.</li>
            <li><span class="text-brand-highlight font-extrabold">4.</span> Weekly sessions + mini performance.</li>
          </ol>

          <div class="hr-glow my-5"></div>

          <p class="text-xs text-brand-text-mid">
            Need help? Email
            <a class="text-brand-highlight hover:text-brand-accent-light" href="mailto:elliotwardillmusic@gmail.com">elliotwardillmusic@gmail.com</a>
            or call
            <a class="text-brand-highlight hover:text-brand-accent-light" href="tel:07368975144">07368 975144</a>.
          </p>
        </div>
      </aside>

      <!-- Form (right on desktop, below on mobile) -->
      <section class="lg:col-span-8">
        <div class="tally-frame">
          <div class="px-5 py-4 border-b border-brand-accent-dark/40 flex items-center justify-between bg-brand-dark-bg/40">
            <span class="text-sm font-extrabold text-brand-text-light">Secure deposit form</span>
            <span class="text-xs text-brand-text-mid">Powered by Tally + Stripe</span>
          </div>

          <div class="p-4 sm:p-6">
            <!-- ✅ Themed embed URL: alignLeft + hideTitle + transparentBackground + dynamicHeight -->
            <iframe
              data-tally-src="https://tally.so/embed/Y5RAlz?alignLeft=1&hideTitle=1&transparentBackground=1&dynamicHeight=1"
              loading="lazy"
              width="100%"
              height="1"
              frameborder="0"
              marginheight="0"
              marginwidth="0"
              title="School Band Programme – Register Interest (Deposit)"
              allow="payment"
              class="tally-iframe"
            ></iframe>
          </div>
        </div>
      </section>
    </div>
  </main>

  <script>
    // Soft gate: stop direct access (best possible on static sites)
    (function () {
      const params = new URLSearchParams(window.location.search);
      const qVerified = params.get("verified") === "1";

      let storeOk = false;
      try {
        const raw = localStorage.getItem("emm_school_band_invite");
        if (raw) {
          const data = JSON.parse(raw);
          // 24 hour window
          storeOk = !!data.ok && (Date.now() - (data.ts || 0)) < 24 * 60 * 60 * 1000;
        }
      } catch (e) {}

      if (!qVerified && !storeOk) {
        window.location.replace("./school-band-programme.html");
        return;
      }

      // Ensure embeds load (especially if cache delays embed.js)
      window.addEventListener("load", () => {
        try { if (window.Tally && typeof window.Tally.loadEmbeds === "function") window.Tally.loadEmbeds(); } catch (e) {}
      });
    })();
  </script>
</body>
</html>
