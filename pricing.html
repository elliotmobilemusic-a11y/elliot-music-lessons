<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elliot Wardill – Lesson Fees & Policy</title>
    <link rel="icon" href="/favicon.png" type="image/png">

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-dark-bg': '#1a1a2e',
                        'brand-accent-light': '#00d084',
                        'brand-accent-dark': '#00a36e',
                        'brand-text-light': '#e0e0e0',
                        'brand-text-mid': '#a0e0e0',
                        'brand-highlight': '#ffb703',
                        'card-bg': '#252538',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        heading: ['Montserrat', 'sans-serif'],
                    },
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Montserrat:wght@700;800;900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a2e;
            background-image: radial-gradient(circle at 100% 100%, #252538 0%, #1a1a2e 70%);
            color: #e0e0e0;
        }
        .card-glow {
            box-shadow: 0 10px 30px rgba(0, 208, 132, 0.12), 0 3px 10px rgba(0, 0, 0, 0.6);
        }
        .policy-table th {
            background-color: #00a36e;
            color: #1a1a2e;
            font-weight: 700;
        }
        .policy-table td {
            background-color: #252538;
            border-bottom: 1px solid #333355;
        }
        .policy-table tr:hover td {
            background-color: #333355;
        }
        .policy-content p {
            margin-bottom: 1rem;
            line-height: 1.6;
            color: #a0a0a0;
        }
        .policy-content h4 {
            font-weight: bold;
            color: #e0e0e0;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-top: 3px solid #ffb703;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Reveal animation (match home page vibe) */
        .reveal {
            opacity: 0;
            transform: translateY(20px);
            transition:
                opacity 0.7s ease-out,
                transform 0.7s ease-out;
        }
        .reveal.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .hover-lift {
            transition:
                transform 0.25s ease,
                box-shadow 0.25s ease,
                border-color 0.2s ease,
                background-color 0.2s ease;
        }
        .hover-lift:hover {
            transform: translateY(-3px);
        }
        .fade-in {
            opacity: 0;
            transform: translateY(6px);
            transition: opacity 0.35s ease-out, transform 0.35s ease-out;
        }
        .fade-in.show {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col text-brand-text-light">

    <!-- NAVIGATION (matches homepage) -->
    <nav class="bg-brand-dark-bg/90 backdrop-blur border-b border-brand-accent-dark/40 text-white sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <a href="index.html" class="flex items-center space-x-2">
                    <span class="inline-flex items-center justify-center w-9 h-9 rounded-full bg-brand-accent-light/10 border border-brand-accent-light/50">
                        <!-- Simple music icon -->
                        <span class="w-4 h-4 border-b-2 border-brand-accent-light rounded-sm inline-block transform translate-y-[1px]"></span>
                    </span>
                    <span class="text-xs sm:text-sm md:text-base font-heading font-extrabold tracking-[0.18em] text-brand-highlight">
                        ELLIOT'S MOBILE MUSIC
                    </span>
                </a>

                <!-- Desktop nav -->
                <div class="hidden sm:flex sm:space-x-4 text-xs md:text-sm">
                    <a href="index.html" class="border-b-2 border-transparent hover:border-brand-accent-light hover:text-white text-brand-text-mid px-3 py-2 font-medium hover-lift">
                        HOME
                    </a>
                    <a href="pricing.html" class="border-b-2 border-brand-accent-light text-brand-accent-light px-3 py-2 font-medium hover-lift">
                        PRICING & FEES
                    </a>
                    <a href="availability.html" class="border-b-2 border-transparent hover:border-brand-accent-light hover:text-white text-brand-text-mid px-3 py-2 font-medium hover-lift">
                        AVAILABILITY
                    </a>
                    <a href="contact.html" class="border-b-2 border-transparent hover:border-brand-accent-light hover:text-white text-brand-text-mid px-3 py-2 font-medium hover-lift">
                        CONTACT
                    </a>
                </div>

                <!-- Mobile button -->
                <div class="sm:hidden">
                    <button id="mobile-menu-button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-300 hover:text-white hover:bg-brand-accent-dark focus:outline-none focus:ring-2 focus:ring-white">
                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none"
                             viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                  d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile menu -->
        <div class="sm:hidden hidden" id="mobile-menu">
            <div class="pt-2 pb-3 space-y-1 px-3 text-sm">
                <a href="index.html" class="block rounded-md text-brand-text-mid hover:bg-brand-accent-dark px-3 py-2 font-medium">HOME</a>
                <a href="pricing.html" class="block rounded-md bg-brand-accent-dark text-white px-3 py-2 font-medium">PRICING & FEES</a>
                <a href="availability.html" class="block rounded-md text-brand-text-mid hover:bg-brand-accent-dark px-3 py-2 font-medium">AVAILABILITY</a>
                <a href="contact.html" class="block rounded-md text-brand-text-mid hover:bg-brand-accent-dark px-3 py-2 font-medium">CONTACT</a>
            </div>
        </div>
    </nav>

    <!-- MAIN -->
    <main class="flex-grow">
        <!-- PAGE HEADER -->
        <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pt-20 sm:pt-24 pb-8">
            <div class="text-center space-y-4 reveal">
                <p class="text-xs font-semibold tracking-[0.28em] text-brand-highlight uppercase">
                    CLEAR, TRANSPARENT PRICING
                </p>
                <h1 class="font-heading text-4xl sm:text-5xl lg:text-6xl font-extrabold text-brand-highlight">
                    Lesson Fees & Travel Policy
                </h1>
                <p class="text-base sm:text-lg text-brand-text-mid max-w-2xl mx-auto">
                    A simple breakdown of lesson prices, travel fees and policies so you always know exactly what to expect.
                </p>
            </div>
        </section>

        <!-- TRAVEL CALCULATOR + MAP -->
        <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pb-12 sm:pb-16">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-stretch">
                <!-- Calculator card -->
                <div class="bg-card-bg/90 rounded-2xl card-glow border border-brand-accent-dark/60 p-6 sm:p-7 space-y-5 reveal">
                    <div>
                        <h2 class="font-heading text-2xl sm:text-3xl font-bold text-brand-accent-light mb-2">
                            Estimate your total lesson cost
                        </h2>
                        <p class="text-sm sm:text-base text-brand-text-mid">
                            Enter your postcode and choose a lesson length. I’ll calculate a real **driving distance** from
                            <strong>Pudsey (LS28)</strong>, then apply the correct travel band and give you a full breakdown.
                        </p>
                    </div>

                    <!-- Inputs -->
                    <div class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                            <div class="md:col-span-1">
                                <label for="lesson-duration" class="block text-xs font-semibold text-brand-text-mid mb-1">
                                    Lesson length
                                </label>
                                <select id="lesson-duration"
                                        class="w-full p-3 rounded-lg bg-brand-dark-bg border border-brand-accent-dark text-sm focus:border-brand-highlight focus:ring-2 focus:ring-brand-highlight/40 outline-none">
                                    <option value="30">30 minutes (£15.00)</option>
                                    <option value="60" selected>60 minutes (£30.00)</option>
                                    <option value="90">90 minutes (£50.00)</option>
                                </select>
                            </div>
                            <div class="md:col-span-2">
                                <label for="postcode-input" class="block text-xs font-semibold text-brand-text-mid mb-1">
                                    Your postcode
                                </label>
                                <input
                                    type="text"
                                    id="postcode-input"
                                    placeholder="Start typing your postcode (e.g. LS28 7...)"
                                    class="w-full p-3 rounded-lg bg-brand-dark-bg border border-brand-accent-dark text-sm focus:border-brand-highlight focus:ring-2 focus:ring-brand-highlight/40 outline-none uppercase"
                                >
                                <p id="postcode-hint" class="mt-1 text-[11px] text-brand-text-mid">
                                    Autocomplete is UK-only. I’ll gently tidy up spacing and casing for you.
                                </p>
                            </div>
                        </div>

                        <button
                            id="check-fee-button"
                            class="w-full px-6 py-3 rounded-lg bg-brand-accent-dark hover:bg-brand-accent-light text-white text-sm font-semibold transition duration-300 transform hover:scale-[1.02] flex items-center justify-center gap-2">
                            <span id="button-text">Calculate final price</span>
                            <span id="loading-spinner" class="spinner hidden"></span>
                        </button>

                        <!-- Friendly band explanation + warnings -->
                        <div id="band-explainer" class="hidden fade-in mt-3 text-xs sm:text-sm rounded-xl border border-brand-accent-dark/50 bg-brand-dark-bg/70 p-3 space-y-1">
                            <p id="band-main" class="font-semibold text-brand-text-light"></p>
                            <p id="band-extra" class="text-brand-text-mid"></p>
                            <p id="band-warning" class="text-[11px] text-red-300 hidden"></p>
                        </div>
                    </div>

                    <!-- Result summary -->
                    <div id="fee-result" class="mt-4 p-4 rounded-xl border border-brand-accent-dark/60 bg-brand-dark-bg/80 hidden fade-in">
                        <!-- Filled by JS -->
                    </div>
                    <p class="text-[11px] text-brand-highlight/70 mt-2">
                        *Distances and times are based on current Google Maps data, but may vary slightly depending on traffic on the day.*
                    </p>
                </div>

                <!-- Map / ETA card -->
                <div class="bg-card-bg/90 rounded-2xl card-glow border border-brand-accent-dark/60 p-6 sm:p-7 flex flex-col justify-between reveal">
                    <div class="mb-4">
                        <h3 class="font-heading text-xl sm:text-2xl font-bold text-brand-accent-light mb-2">
                            Journey snapshot
                        </h3>
                        <p class="text-sm text-brand-text-mid mb-3">
                            Once you calculate, you’ll see a live map preview and travel stats from **Pudsey (LS28)** to your postcode:
                            distance, ETA and which travel band you fall into.
                        </p>
                    </div>

                    <div id="map-container" class="space-y-4">
                        <div class="aspect-[16/9] w-full rounded-xl overflow-hidden border border-brand-accent-dark/60 bg-brand-dark-bg flex items-center justify-center">
                            <img id="map-thumb" src="" alt="Route map preview" class="w-full h-full object-cover hidden">
                            <div id="map-placeholder" class="text-center text-xs text-brand-text-mid px-6">
                                Once you enter a postcode and calculate, a route preview will appear here.
                            </div>
                        </div>

                        <div id="travel-summary" class="rounded-xl bg-brand-dark-bg/80 border border-brand-accent-dark/50 p-4 text-xs sm:text-sm space-y-1 hidden">
                            <p id="eta-text" class="font-semibold text-brand-text-light"></p>
                            <p id="distance-text" class="text-brand-text-mid"></p>
                            <p id="origin-dest-text" class="text-brand-text-mid text-[11px]"></p>
                        </div>
                    </div>

                    <div class="mt-5 text-xs sm:text-sm text-brand-text-mid">
                        <p class="font-semibold text-brand-text-light mb-1">How travel fees work:</p>
                        <ul class="list-disc list-inside space-y-1">
                            <li>Travel is always calculated from a fixed starting point in <strong>Pudsey (LS28)</strong>.</li>
                            <li>Banding is based on driving distance, not “as the crow flies”.</li>
                            <li>For journeys over 15 miles, a simple flat rate of <strong>£20</strong> is applied.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- STANDARD RATES -->
        <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pb-10 sm:pb-14">
            <div class="bg-card-bg/90 rounded-2xl card-glow border border-brand-accent-dark/60 p-6 sm:p-8 space-y-5 reveal">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                    <div>
                        <h2 class="font-heading text-2xl sm:text-3xl font-bold text-brand-accent-light mb-2">
                            Standard lesson rates
                        </h2>
                        <p class="text-sm sm:text-base text-brand-text-mid">
                            These are the core lesson prices before any travel fee is added.
                        </p>
                    </div>
                    <div class="text-xs sm:text-sm text-brand-highlight bg-brand-dark-bg/60 rounded-lg px-4 py-2 border border-brand-highlight/60">
                        Introductory first lesson is always <strong>£10</strong>.
                    </div>
                </div>

                <div class="overflow-x-auto rounded-lg mt-4">
                    <table class="w-full text-left policy-table text-brand-text-light text-sm sm:text-base">
                        <thead>
                            <tr>
                                <th class="px-6 py-3">Lesson Duration</th>
                                <th class="px-6 py-3">Fee (Base)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="px-6 py-4 font-semibold">Introductory Offer (First Lesson)</td>
                                <td class="px-6 py-4 text-brand-highlight font-extrabold">£10.00</td>
                            </tr>
                            <tr>
                                <td class="px-6 py-4 font-semibold">30 Minutes</td>
                                <td class="px-6 py-4">£15.00</td>
                            </tr>
                            <tr>
                                <td class="px-6 py-4 font-semibold">60 Minutes</td>
                                <td class="px-6 py-4">£30.00</td>
                            </tr>
                            <tr>
                                <td class="px-6 py-4 font-semibold">90 Minutes</td>
                                <td class="px-6 py-4">£50.00</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <p class="mt-3 text-xs sm:text-sm text-brand-text-mid">
                    Payment can be made in cash at the lesson or via bank transfer in advance.
                </p>
            </div>
        </section>

        <!-- TRAVEL & CANCELLATION -->
        <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pb-14 sm:pb-20">
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Travel -->
                <div class="p-6 sm:p-7 bg-card-bg/90 rounded-2xl card-glow border border-brand-accent-dark/60 reveal">
                    <h3 class="font-heading text-2xl font-bold text-brand-accent-light mb-3">
                        Travel fee bands (from Pudsey, LS28)
                    </h3>
                    <p class="text-sm text-brand-text-mid mb-4">
                        Most pupils fall within the first two bands. The calculator above uses these values to give you a clear total.
                    </p>
                    <table class="w-full text-left policy-table text-brand-text-light text-xs sm:text-sm mb-3">
                        <thead>
                            <tr>
                                <th class="px-4 py-2">Driving Distance</th>
                                <th class="px-4 py-2">Additional Travel Fee</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td class="px-4 py-2">Under 5 Miles</td><td class="px-4 py-2">£0.00</td></tr>
                            <tr><td class="px-4 py-2">5 – 10 Miles</td><td class="px-4 py-2">£5.00</td></tr>
                            <tr><td class="px-4 py-2">10 – 15 Miles</td><td class="px-4 py-2">£10.00</td></tr>
                            <tr><td class="px-4 py-2">15+ Miles</td><td class="px-4 py-2">£20.00 (Flat Rate)</td></tr>
                        </tbody>
                    </table>
                    <p class="text-xs sm:text-sm text-brand-highlight/80">
                        For especially long or complex journeys, we can always chat and agree a sensible plan together.
                    </p>
                </div>

                <!-- Cancellation -->
                <div class="p-6 sm:p-7 bg-card-bg/90 rounded-2xl card-glow border border-brand-accent-dark/60 reveal">
                    <h3 class="font-heading text-2xl font-bold text-brand-accent-light mb-3">
                        Cancellation & rescheduling
                    </h3>
                    <ul class="list-disc ml-5 space-y-3 text-sm text-brand-text-mid">
                        <li><strong>24 hours’ notice</strong> is kindly requested to cancel or reschedule a lesson.</li>
                        <li>Cancellations with less than 24 hours’ notice may be charged at <strong>50%</strong> of the usual fee.</li>
                        <li>If I ever need to cancel, we simply reschedule at no extra cost.</li>
                    </ul>
                    <p class="mt-3 text-xs text-brand-text-mid">
                        Life happens – if there’s illness or a genuine emergency, I’ll always try to be fair and understanding.
                    </p>
                </div>
            </div>
        </section>

        <!-- FULL POLICY -->
        <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pb-20">
            <div class="bg-brand-dark-bg/90 p-6 sm:p-7 rounded-2xl card-glow border border-brand-accent-dark/60 reveal">
                <button id="toggle-policy"
                        class="w-full text-left p-4 rounded-lg bg-brand-accent-dark hover:bg-brand-accent-light text-white font-bold text-sm sm:text-base transition duration-300 flex justify-between items-center">
                    <span>View full music lesson policy document</span>
                    <span id="toggle-icon">▼</span>
                </button>

                <div id="full-policy-text" class="hidden policy-content mt-4 p-4 border border-brand-accent-dark/50 rounded-lg max-h-96 overflow-y-auto text-xs sm:text-sm">
                    <h3 class="font-heading text-xl sm:text-2xl font-bold text-brand-highlight mb-3">Elliot Wardill – Music Lesson Policy</h3>

                    <p>Hello, and thank you for booking music lessons. I am <strong>Elliot Wardill</strong>, a musician and educator based in Pudsey. I have been playing piano and singing for several years and currently work within the education sector. This policy outlines key terms to keep everything clear and straightforward.</p>

                    <p>I bring all the necessary equipment (including a keyboard where needed) to your home, so there is no need to travel. Lessons are designed to be fun, safe, and confidence-building, whatever your goals.</p>

                    <h4>1. Safety and safeguarding</h4>
                    <p>I hold a valid <strong>DBS check</strong> for working with children. Parents and guardians are very welcome to sit in on lessons.</p>
                    <p>If your child is enrolled at Stanningley Primary School, any information or safeguarding concerns disclosed to me during lesson times will be reported directly to the school in line with their procedures.</p>

                    <h4>2. Lesson fees and payment</h4>
                    <p><strong>First lesson:</strong> £10 (introductory offer).</p>
                    <p><strong>Standard lessons:</strong> 30 minutes – £15, 60 minutes – £30, 90 minutes – £50.</p>
                    <p>The total price, including the travel fee, is shown by the calculator above and will always be clearly agreed in advance.</p>

                    <h4>3. Cancellations and rescheduling</h4>
                    <p>Please give at least <strong>24 hours’ notice</strong> if you need to cancel or move a lesson.</p>
                    <p>Cancellations with less than 24 hours’ notice may be charged at <strong>50%</strong> of the lesson fee.</p>
                    <p>If I need to cancel for any reason, we will reschedule the lesson at no additional cost.</p>

                    <h4>4. Lesson structure and approach</h4>
                    <p>Lessons are tailored to each student’s age, interests and confidence level. For beginners, we’ll usually start with simple songs and warm-ups to build a solid foundation.</p>
                    <p>We work on musicality, rhythm, performance confidence and (if desired) music reading – always at a pace that feels manageable and enjoyable.</p>

                    <h4>5. Travel and location</h4>
                    <p>Lessons are based from a fixed starting point in <strong>Pudsey (LS28)</strong>. Travel fees are calculated using the estimated <strong>driving distance</strong> from Pudsey to your postcode and are added to the standard lesson cost:</p>
                    <ul class="list-disc ml-5">
                        <li>Under 5 miles – <strong>£0.00</strong></li>
                        <li>5 – 10 miles – <strong>£5.00</strong></li>
                        <li>10 – 15 miles – <strong>£10.00</strong></li>
                        <li>15+ miles – <strong>£20.00</strong> (flat rate)</li>
                    </ul>
                    <p>The pricing tool on this page uses these bands to give a clear, realistic estimate.</p>

                    <h4>6. Availability</h4>
                    <p>Standard teaching times are currently: Tuesday, Wednesday and Thursday evenings, roughly 6pm – 9pm. Saturday and Sunday may be available on request. Monday and Friday are typically unavailable.</p>

                    <h4>7. Photo and video consent</h4>
                    <p>Occasionally, photos or short clips may be taken to celebrate progress. This is always optional and only ever with consent.</p>
                    <p>Where consent is given, media may be used on social media or a website using first names only. Consent can be withdrawn at any time by email, and no new content will be posted from that point onward.</p>

                    <h4>8. Contact details</h4>
                    <p>Phone: 07368 975144<br>Email: elliotmobilemusic@gmail.com</p>
                </div>
            </div>
        </section>
    </main>

    <!-- FOOTER -->
    <footer class="bg-gray-900 text-brand-text-mid py-7 mt-2">
        <div class="max-w-6xl mx-auto px-4 text-center text-xs sm:text-sm">
            <p>&copy; 2024 Elliot Wardill Mobile Music Lessons. All rights reserved.</p>
            <p class="mt-1 text-gray-500">
                DBS Checked & Insured. Full lesson policy and travel information available on this page.
            </p>
        </div>
    </footer>

    <!-- GOOGLE MAPS JS (with your key) -->
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCztWhTrSCVgN1VrzKupHOdpWNreLuvTGs&libraries=places&callback=initTravelEstimator"
        async defer>
    </script>

    <!-- PAGE JS -->
    <script>
        // Mobile menu
        document.getElementById('mobile-menu-button').addEventListener('click', () => {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        });

        // Reveal on scroll
        const revealEls = document.querySelectorAll('.reveal');
        const revealObserver = new IntersectionObserver(
            entries => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        revealObserver.unobserve(entry.target);
                    }
                });
            },
            { threshold: 0.15 }
        );
        revealEls.forEach(el => revealObserver.observe(el));

        // Policy collapse
        document.getElementById('toggle-policy').addEventListener('click', () => {
            const box = document.getElementById('full-policy-text');
            const icon = document.getElementById('toggle-icon');
            const hidden = box.classList.contains('hidden');
            box.classList.toggle('hidden');
            icon.textContent = hidden ? '▲' : '▼';
        });

        // ---------------- GOOGLE MAPS TRAVEL CALCULATOR ----------------
        const LESSON_RATES = { 30: 15.00, 60: 30.00, 90: 50.00 };
        const ORIGIN_ADDRESS = "Pudsey, LS28, UK";

        let autocomplete;
        let lastPlaceResult = null; // store last good destination for map
        let mapsReady = false;

        function safeFadeShow(el) {
            if (!el) return;
            el.classList.add('show');
        }

        function metersToMiles(m) {
            return m / 1609.344;
        }

        function classifyBand(miles) {
            let band = "Under 5 miles (local)";
            let fee = 0;
            let colourClass = "text-brand-accent-light";
            let note = "This is a local journey from Pudsey, with no additional travel fee.";

            if (miles >= 5 && miles < 10) {
                band = "5 – 10 miles (short drive)";
                fee = 5;
                note = "This is a short drive – a small travel fee helps cover time and fuel.";
            } else if (miles >= 10 && miles < 15) {
                band = "10 – 15 miles (extended drive)";
                fee = 10;
                colourClass = "text-brand-highlight";
                note = "A longer journey with a modest extra fee to keep things sustainable.";
            } else if (miles >= 15) {
                band = "15+ miles (extended area)";
                fee = 20;
                colourClass = "text-red-300";
                note = "For longer distances, a simple flat £20 travel fee keeps things fair and predictable.";
            }

            return { band, fee, colourClass, note };
        }

        function storeLastPostcode(pc) {
            try {
                localStorage.setItem('elliot_last_postcode', pc);
            } catch (_) {}
        }

        function loadLastPostcode() {
            try {
                return localStorage.getItem('elliot_last_postcode') || "";
            } catch (_) {
                return "";
            }
        }

        function normalisePostcodeInput(raw) {
            if (!raw) return "";
            let cleaned = raw.toUpperCase().trim();
            cleaned = cleaned.replace(/\s+/g, " ");
            return cleaned;
        }

        window.initTravelEstimator = function initTravelEstimator() {
            mapsReady = true;
            const input = document.getElementById('postcode-input');
            const lastPc = loadLastPostcode();
            if (lastPc) input.value = lastPc;

            autocomplete = new google.maps.places.Autocomplete(input, {
                componentRestrictions: { country: "uk" },
                fields: ["formatted_address", "geometry", "place_id", "name"]
            });

            autocomplete.addListener("place_changed", () => {
                const place = autocomplete.getPlace();
                lastPlaceResult = place && place.geometry ? place : null;
            });

            document.getElementById('check-fee-button').addEventListener('click', handleCalculate);
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    handleCalculate();
                }
            });
        };

        async function handleCalculate() {
            const durationEl = document.getElementById('lesson-duration');
            const postcodeInput = document.getElementById('postcode-input');
            const buttonText = document.getElementById('button-text');
            const spinner = document.getElementById('loading-spinner');
            const feeResult = document.getElementById('fee-result');
            const bandBox = document.getElementById('band-explainer');
            const bandMain = document.getElementById('band-main');
            const bandExtra = document.getElementById('band-extra');
            const bandWarning = document.getElementById('band-warning');
            const mapThumb = document.getElementById('map-thumb');
            const mapPlaceholder = document.getElementById('map-placeholder');
            const travelSummary = document.getElementById('travel-summary');
            const etaText = document.getElementById('eta-text');
            const distanceText = document.getElementById('distance-text');
            const originDestText = document.getElementById('origin-dest-text');

            if (!mapsReady) {
                alert("Map services are still loading. Please wait a second and try again.");
                return;
            }

            let raw = postcodeInput.value;
            raw = normalisePostcodeInput(raw);
            postcodeInput.value = raw;

            if (!raw) {
                feeResult.classList.remove('show');
                feeResult.classList.remove('hidden');
                feeResult.innerHTML = `<p class="text-red-300 text-sm font-semibold">Please enter a postcode before calculating.</p>`;
                return;
            }

            // UI: start loading
            buttonText.textContent = "Calculating...";
            spinner.classList.remove('hidden');
            feeResult.classList.add('hidden');
            bandBox.classList.add('hidden');
            travelSummary.classList.add('hidden');
            bandWarning.classList.add('hidden');

            try {
                storeLastPostcode(raw);

                // Get destination: prefer autocomplete geometry, fallback to geocode
                let destLocation = null;
                let destLabel = raw;

                if (lastPlaceResult && lastPlaceResult.geometry) {
                    destLocation = lastPlaceResult.geometry.location;
                    destLabel = lastPlaceResult.formatted_address || lastPlaceResult.name || raw;
                } else {
                    destLocation = await geocodeAddress(raw);
                }

                if (!destLocation) {
                    throw new Error("Could not find that postcode location.");
                }

                const distanceData = await getDrivingDistance(ORIGIN_ADDRESS, destLocation);
                if (!distanceData) {
                    throw new Error("Unable to retrieve driving distance.");
                }

                const miles = metersToMiles(distanceData.distance.value);
                const mins = distanceData.duration.value / 60;
                const bandInfo = classifyBand(miles);

                const lessonDuration = durationEl.value;
                const baseFee = LESSON_RATES[lessonDuration] || 0;
                const total = baseFee + bandInfo.fee;

                // Result box
                feeResult.innerHTML = `
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                        <div class="text-xs sm:text-sm text-brand-text-mid">
                            <p><span class="font-semibold text-brand-text-light">Lesson:</span> ${lessonDuration} minutes</p>
                            <p><span class="font-semibold text-brand-text-light">Postcode:</span> ${destLabel}</p>
                            <p><span class="font-semibold text-brand-text-light">Band:</span> <span class="${bandInfo.colourClass}">${bandInfo.band}</span></p>
                        </div>
                        <div class="text-right text-xs sm:text-sm">
                            <p>Lesson fee: <span class="font-semibold text-brand-text-light">£${baseFee.toFixed(2)}</span></p>
                            <p>Travel fee: <span class="font-semibold ${bandInfo.colourClass}">£${bandInfo.fee.toFixed(2)}</span></p>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-brand-accent-light/40">
                        <p class="text-brand-highlight text-2xl sm:text-3xl font-extrabold">
                            Estimated total: £${total.toFixed(2)}
                        </p>
                        <p class="mt-1 text-[11px] text-brand-text-mid">
                            This is an estimate based on current route data – I’ll always confirm the exact price with you when booking.
                        </p>
                    </div>
                `;
                feeResult.classList.remove('hidden');
                setTimeout(() => safeFadeShow(feeResult), 10);

                // Band explainer
                bandMain.textContent = bandInfo.band;
                bandExtra.textContent = bandInfo.note;
                bandWarning.classList.add('hidden');

                if (miles >= 15) {
                    bandWarning.textContent = "This is classed as an extended-area visit. Sometimes I may suggest slightly longer gaps between lessons, or grouping sessions together, to keep travel fair.";
                    bandWarning.classList.remove('hidden');
                }

                bandBox.classList.remove('hidden');
                setTimeout(() => safeFadeShow(bandBox), 10);

                // Travel summary
                const milesRounded = miles.toFixed(1);
                const minsRounded = Math.round(mins);
                etaText.textContent = `Typical drive time: around ${minsRounded} minute${minsRounded === 1 ? "" : "s"}.`;
                distanceText.textContent = `Estimated driving distance: approximately ${milesRounded} miles (${bandInfo.band}).`;
                originDestText.textContent = `Route: ${ORIGIN_ADDRESS} → ${destLabel}`;
                travelSummary.classList.remove('hidden');

                // Static map thumbnail
                const lat = destLocation.lat();
                const lng = destLocation.lng();
                const staticUrl =
                    "https://maps.googleapis.com/maps/api/staticmap" +
                    "?size=640x360&scale=2&maptype=roadmap" +
                    `&markers=color:0x00d084|label:E|${encodeURIComponent(ORIGIN_ADDRESS)}` +
                    `&markers=color:0xffb703|label:S|${lat},${lng}` +
                    `&path=color:0x00a36e|weight:4|${encodeURIComponent(ORIGIN_ADDRESS)}|${lat},${lng}` +
                    `&key=AIzaSyCztWhTrSCVgN1VrzKupHOdpWNreLuvTGs`;

                mapThumb.src = staticUrl;
                mapThumb.onload = () => {
                    mapThumb.classList.remove('hidden');
                    mapPlaceholder.classList.add('hidden');
                };
                mapThumb.onerror = () => {
                    mapThumb.classList.add('hidden');
                    mapPlaceholder.classList.remove('hidden');
                    mapPlaceholder.textContent = "The map image couldn’t be loaded just now, but the distance and pricing above are still accurate.";
                }

            } catch (err) {
                console.error(err);
                feeResult.classList.remove('hidden');
                feeResult.innerHTML = `
                    <p class="text-red-300 text-sm font-semibold mb-1">Sorry, something went wrong working out that route.</p>
                    <p class="text-xs text-brand-text-mid">Please double-check the postcode, or message Elliot directly and he’ll confirm the exact price with you.</p>
                `;
            } finally {
                buttonText.textContent = "Calculate final price";
                spinner.classList.add('hidden');
            }
        }

        function geocodeAddress(address) {
            const geocoder = new google.maps.Geocoder();
            return new Promise((resolve, reject) => {
                geocoder.geocode({ address }, (results, status) => {
                    if (status === "OK" && results[0] && results[0].geometry) {
                        resolve(results[0].geometry.location);
                    } else {
                        reject(new Error("Geocoding failed: " + status));
                    }
                });
            });
        }

        function getDrivingDistance(origin, destLocation) {
            const service = new google.maps.DistanceMatrixService();
            const destLatLng = destLocation;

            return new Promise((resolve, reject) => {
                service.getDistanceMatrix(
                    {
                        origins: [origin],
                        destinations: [destLatLng],
                        travelMode: google.maps.TravelMode.DRIVING,
                        unitSystem: google.maps.UnitSystem.METRIC,
                    },
                    (response, status) => {
                        if (status !== "OK") {
                            reject(new Error("DistanceMatrix failed: " + status));
                            return;
                        }
                        const row = response.rows[0];
                        if (!row || !row.elements || !row.elements[0] || row.elements[0].status !== "OK") {
                            reject(new Error("No valid distance result."));
                            return;
                        }
                        resolve(row.elements[0]);
                    }
                );
            });
        }
    </script>
</body>
</html>
