<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Portal – Elliot’s Mobile Music Lessons</title>
    <link rel="icon" href="/favicon.png">

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-dark-bg': '#1a1a2e',
                        'brand-accent-light': '#00d084',
                        'brand-accent-dark': '#00a36e',
                        'brand-text-light': '#e0e0e0',
                        'brand-text-mid': '#a0a0a0',
                        'brand-highlight': '#ffb703',
                        'card-bg': '#252538',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        heading: ['Montserrat', 'sans-serif'],
                    },
                }
            }
        }
    </script>

    <style>
        @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Montserrat:wght@700;800;900&display=swap");

        body {
            background: #1a1a2e;
            color: #e0e0e0;
            background-image: radial-gradient(circle at 100% 100%, #252538 0%, #1a1a2e 70%);
        }

        .card-glow {
            box-shadow: 0 0 35px rgba(0, 208, 132, 0.15);
        }

        .modal-bg {
            backdrop-filter: blur(6px);
            background: rgba(0,0,0,0.5);
        }
    </style>

    <!-- Lucide Icons -->
    <script type="module">
        import { createIcons, LogOut, Mail, Newspaper } from "https://cdn.jsdelivr.net/npm/lucide@latest/dist/esm/lucide.js";
        createIcons({ icons: { LogOut, Mail, Newspaper } });
    </script>

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

</head>
<body class="min-h-screen flex flex-col">

<!-- NAVIGATION -->
<nav class="bg-brand-dark-bg/90 backdrop-blur border-b border-brand-accent-dark/40 text-white sticky top-0 z-40">
    <div class="max-w-6xl mx-auto px-4 flex justify-between items-center h-16">
        <a href="index.html" class="flex items-center space-x-2">
            <span class="inline-flex items-center justify-center w-9 h-9 rounded-full bg-brand-accent-light/10 border border-brand-accent-light/50">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                     fill="none" stroke="currentColor" stroke-width="2"
                     class="w-5 h-5 text-brand-accent-light">
                     <circle cx="8" cy="18" r="4"></circle>
                     <path d="M12 18V2l7 4"></path>
                </svg>
            </span>
            <span class="font-heading tracking-[0.18em] text-brand-highlight text-sm sm:text-base">
                STUDENT PORTAL
            </span>
        </a>

        <button id="logout-btn" class="flex items-center gap-1 text-brand-text-light hover:text-white">
            <i data-lucide="log-out" class="w-5 h-5"></i>
            Logout
        </button>
    </div>
</nav>

<!-- MAIN -->
<main class="max-w-4xl mx-auto px-4 py-10 flex-grow">

    <h1 class="text-center font-heading text-4xl sm:text-5xl font-extrabold text-brand-accent-light mb-10">
        Your Newsletters
    </h1>

    <!-- Where newsletters appear -->
    <div id="newsletter-list" class="space-y-6"></div>

    <!-- Empty State -->
    <div id="no-newsletters" class="hidden text-center text-brand-text-mid mt-10">
        <i data-lucide="newspaper" class="w-10 h-10 mx-auto mb-3"></i>
        <p>No newsletters have been published yet.</p>
    </div>

</main>

<!-- Newsletter Modal -->
<div id="newsletter-modal" class="hidden fixed inset-0 modal-bg z-50 flex items-center justify-center p-4">
    <div class="bg-card-bg max-w-2xl w-full p-6 rounded-xl card-glow border border-brand-accent-dark/40 relative overflow-y-auto max-h-[90vh]">
        <button id="close-modal" class="absolute top-3 right-3 text-brand-text-mid hover:text-white">
            ✕
        </button>
        <h2 id="modal-title" class="text-3xl font-heading font-bold mb-4 text-brand-accent-light"></h2>
        <div id="modal-content" class="prose prose-invert max-w-none"></div>
    </div>
</div>

<script>
    const SUPABASE_URL = "https://gorrhpliwhpznmdqhzjo.supabase.co";
    const SUPABASE_ANON_KEY = "YOUR_ANON_KEY_HERE"; // <-- replace this
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const newsletterList = document.getElementById("newsletter-list");
    const noNewsletters = document.getElementById("no-newsletters");

    const modal = document.getElementById("newsletter-modal");
    const modalTitle = document.getElementById("modal-title");
    const modalContent = document.getElementById("modal-content");

    const closeModal = document.getElementById("close-modal");

    closeModal.onclick = () => modal.classList.add("hidden");

    async function loadNewsletters() {
        const { data: newsletters, error } = await supabase
            .from("newsletters")
            .select("*")
            .eq("published", true)
            .order("created_at", { ascending: false });

        if (!newsletters || newsletters.length === 0) {
            noNewsletters.classList.remove("hidden");
            return;

            <section id="student-newsletters" class="space-y-4">
  <h2 class="font-heading text-xl text-brand-highlight">Latest Newsletters</h2>
  <div id="newsletter-list" class="space-y-3"></div>
</section>
    <h2 class="font-heading text-xl text-brand-highlight">Latest Newsletters</h2>

    <div id="newsletter-cards" class="space-y-3">
        <!-- Filled by JS -->
    </div>
</section>


        
        }

        newsletters.forEach(n => {
            const card = document.createElement("div");
            card.className = "bg-card-bg p-5 rounded-xl border border-brand-accent-dark/40 card-glow hover:scale-[1.01] transition cursor-pointer";
            card.innerHTML = `
                <h2 class="text-2xl font-heading text-brand-accent-light mb-2">${n.title}</h2>
                <p class="text-brand-text-mid text-sm">${new Date(n.created_at).toLocaleDateString()}</p>
            `;
            card.onclick = () => {
                modalTitle.textContent = n.title;
                modalContent.innerHTML = n.content_html;
                modal.classList.remove("hidden");
            };

            newsletterList.appendChild(card);
        });
    }

    async function protectRoute() {
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) {
            window.location.href = "login.html";
        }
    }

    document.getElementById("logout-btn").onclick = async () => {
        await supabase.auth.signOut();
        window.location.href = "login.html";
    };

    protectRoute();
    loadNewsletters();
</script>

</body>
</html>
